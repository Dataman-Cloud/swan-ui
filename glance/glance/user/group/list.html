<div class="main-container-body">
    <button class="btn btn-success" type="button"
            ng-click="listGroupCtrl.isCollapsed = !listGroupCtrl.isCollapsed" data-demo-disable>创建用户组</button>
    <div id="create-usergroup-panel" uib-collapse="listGroupCtrl.isCollapsed">
        <div class="well well-sm">
            <form class="form-inline" name="staticForm">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="用户组名称"
                           data-ng-model="listGroupCtrl.createGroupForm.name" data-required>
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="用户组描述"
                           data-ng-model="listGroupCtrl.createGroupForm.description">
                </div>
                <button type="submit" class="btn btn-success"
                        data-ng-click="listGroupCtrl.createGroup()" data-demo-disable>创建</button>
                <button type="submit" class="btn btn-default"
                        ng-click="listGroupCtrl.isCollapsed = !listGroupCtrl.isCollapsed">取消</button>
            </form>
        </div>
    </div>
    <hr>
</div>

<md-table-container>
    <table md-table>
        <thead md-head md-order="listGroupCtrl.table.query.order"
               md-on-reorder="listGroupCtrl.table.getOrder">
        <tr md-row>
            <th md-column md-order-by="name">用户组</th>
            <th md-column>角色</th>
            <th md-column>用户数量</th>
            <th md-column md-order-by="created_at">建立时间</th>
            <th md-column>操作</th>
        </tr>
        </thead>
        <tbody md-body>
        <tr md-row md-select="group" ng-repeat-start="group in listGroupCtrl.groups">
            <td md-cell>
                <h5>{/group.name/}</h5>
                <p><em data-ng-show="group.role.id != 1">{/group.owner.email/}</em></p>
                <p>{/group.description/}</p>
            </td>
            <td md-cell>
                {/listGroupCtrl.roleMapping[group.role.name]/}
            </td>
            <td md-cell>{/group.user_count/}</td>
            <td md-cell>{/group.created_at | date:"yyyy-MM-dd HH:mm:ss"/}</td>
            <td md-cell>
                <md-button aria-label="manage" class="md-button md-raised"
                        data-ng-click="listGroupCtrl.collapseManagePanel(group.id)"
                        data-ng-show="group.role.id == 1" data-demo-disable>管理用户</md-button>
                <md-button aria-label="delete" class="md-button md-raised"
                        data-ng-click="listGroupCtrl.deleteGroup(group.id, $event)"
                        data-ng-show="group.role.id == 1" data-demo-disable>删除用户组</md-button>
                <md-button aria-label="leave" class="md-button md-raised"
                        data-ng-click="listGroupCtrl.leaveGroup(group.id, $event)"
                        data-ng-show="group.role.id != 1 && group.status == 'normal'" data-demo-disable>离开用户组
                </md-button>
                <md-button aria-label="join" class="md-button md-raised"
                        data-ng-click="listGroupCtrl.joinInvitedGroup(group.id)"
                        data-ng-show="group.role.id != 1 && group.status == 'not_join'" data-demo-disable>加入
                </md-button>
                <md-button aria-label="leave" class="md-button md-raised"
                        data-ng-click="listGroupCtrl.leaveGroup(group.id, $event)"
                        data-ng-show="group.role.id != 1 && group.status == 'not_join'" data-demo-disable>放弃
                </md-button>
            </td>
        </tr>
        <tr data-ng-show="group.role.id == 1"
            uib-collapse="listGroupCtrl.isCollapsedGroupMapping[group.id]" ng-repeat-end>
            <td colspan="5">
                <div class="row">
                    <div class="col-md-4 col-lg-3 btn-show-invite" data-ng-show="!listGroupCtrl.isOpenInvite[group.id]"
                         data-ng-click="listGroupCtrl.isOpenInvite[group.id]=!listGroupCtrl.isOpenInvite[group.id]">
                        <div class="well well-sm text-center usergroup-user-card">
                            <span><i class="fa fa-plus"></i> 邀请用户</span>
                        </div>
                    </div>
                    <div class="col-md-8 col-lg-6" data-ng-show="listGroupCtrl.isOpenInvite[group.id]">
                        <div class="well well-sm">
                            <div class="input-group">
                                <span class="input-group-addon">邀请用户</span>
                                <input type="text" class="form-control" placeholder="mail1, mail2, ..."
                                       data-ng-model="listGroupCtrl.emailsList[group.id]">
                                    <span class="input-group-btn">
                                        <button class="btn btn-success" type="button"
                                                data-ng-click="listGroupCtrl.sendInvitation(group.id)" data-demo-disable> 添加 </button>
                                    </span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-3" data-ng-repeat="user in listGroupCtrl.groupUserMapping[group.id]">
                        <div class="well well-sm usergroup-user-card">
                            <h5>{/user.user.email/}</h5>
                            <div>
                                <time>{/user.created_at | date:"yyyy-MM-dd HH:mm:ss"/}</time>
                                <span class="label label-warning" data-ng-show="user.status=='not_join'">待加入</span>
                            </div>
                            <button class="btn btn-danger btn-xs"
                                    data-ng-click="listGroupCtrl.deleteGroupUser(group.id, user.user.id)" data-demo-disable><i class="fa fa-trash-o"></i></button>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
    <div class="alert alert-warning text-center" data-ng-show="!listGroupCtrl.groups.length">
        未查询到用户组
    </div>
</md-table-container>

<md-table-pagination
        md-label="{page: '页:', rowsPerPage: '每页:', of: 'of'}" md-limit="listGroupCtrl.table.query.limit"
        md-limit-options="[20, 50, 100]"
        md-page="listGroupCtrl.table.query.page" md-total="{/listGroupCtrl.count/}"
        md-on-paginate="listGroupCtrl.table.getPage" md-page-select></md-table-pagination>
